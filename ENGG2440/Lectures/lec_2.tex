\chapter{Summation Techniques}

\section{Summation}
When summing numbers with certain patterns, we can use summation notation. For example,
\[
	a_1 + a_2 + \cdots + a_n = \sum_{k=1}^n a_k 
\]

\subsection{Distributive Law}
Let \(c\) be a constant. Then, we can take \(c\) out of the summation:
\[
	\sum_{k\in\mathcal{K} } ca_k = c\sum_{k\in\mathcal{K} }a_k 
\]

\begin{eg}
	\[
		\sum_{k=1}^n 2k = 2(1) + 2(2) + 2(3) + \cdots + 2(n) = 2(1 + 2 + 3 + \cdots + n) = 2\sum_{k=1}^n k  
	\]
\end{eg}

\subsection{Associative Law}
We can split the summands as follows:

\[
	\sum_{k\in\mathcal{K}}(a_k + b_K) = \sum_{k\in\mathcal{K}}a_k + \sum_{k\in\mathcal{K}}b_k
\]

\begin{eg}
	\[\begin{aligned}
		\sum_{k = 1}^n(k + k^2) &= (1 + 1^2) + (2 + 2^2) + \cdots + (n + n^2) \\
		&= (1 + 2 + \cdots + n) + (1^2 + 2^2 + \cdots + n^2) \\
		&= \sum_{k = 1}^n k + \sum_{k = 1}^n k^2
	\end{aligned}\]
\end{eg}

\section{Close Form Formula}
Close form formula is the formula that does not have the summation index \(k\) for a sum by simply writing it out explicitly. For example,
\[
	\sum_{k = 1}^n (a_{k} - a_{k-1})
\]

By expanding the sum, we have
\[
	\sum_{k = 1}^n (a_{k} - a_{k-1}) = (a_1 - a_0) + (a_2 - a_1) + \cdots + (a_n - a_{n-1}) = a_n - a_0
\]
By cancelling the terms, we get \(a_n - a_0\), which is the close form formula for the summation \(\sum_{k = 1}^n (a_{k} - a_{k-1})\).

\section{Perturbation Method}
It could be difficult to derive the close form formula for some summation. Therefore, we can use the perturbation method.

For summation
\[
S_n = \sum_{k = 1}^n a_k,
\]
we can split off the first term and the last term, then rewrite it as
\[
	a_1 + \sum_{k = 2}^{n + 1} a_k = S_{n+1} = \sum_{k = 1}^{n} a_k + a_{n + 1}
\]

\begin{eg}[Geometric Sum]
	Let \(x\)  be any number. Consider the sum
	\[
		S_n = \sum_{k = 1}^n x^k
	\]
	\[
		x + \sum_{k = 2}^{n + 1} x^k = S_{n+1} = \sum_{k = 1}^{n} x^k + x^{n+1}
	\]
	Observe that
	\[
	\sum_{k = 2}^{n + 1} x^k = x^2 + x^3 + \cdots + x^{n+1} = x(x + x^2 + \cdots + x^n) = xS_n
	\]
	By substitution, we have
\[
	x+ xS_n = S_n + x^{n+1}
\]
If \(x \neq 1\), then we can solve for \(S_n\) to get
\[
	S_n = \dfrac{x(1 - x^n)}{1 - x}
\] 
This summation is also called geometric sum.
\end{eg}

By applying the perturbation method, we can find the close form formula for some common summation. Another example is Quadratic Series.

\newpage
\begin{eg}[Quadratic Series]
	By applying perturbation method to the sum
	\[
		S_n = \sum_{k = 1}^n k^2,
	\]
	we have
	\[
		1 + \sum_{k = 2}^{n + 1} k^2 = S_{n + 1} = \sum_{k = 1}^n  k^2 + (n + 1)^2 
	\]
	Let \(j = k - 1\),
	\[
		\sum_{k = 2}^{n + 1} k^2 = \sum_{j = 1}^{n} (j + 1)^2
	\]
	\[
	\begin{aligned}
		\sum_{j = 1}^{n} (j + 1)^2 &= \sum_{j = 1}^n (j^2 + 2j + 1) \\
		&=  \sum_{j = 1}^n j^2 + 2\sum_{j = 1}^n j + \sum_{j = 1}^n 1 \\
		&= S_n + 2\sum_{j = 1}^n j + n
	\end{aligned}
	\]
	Then, we have
	\[
		\begin{aligned}
			1 + \sum_{k = 2}^{n + 1} k^2 &= \sum_{k = 1}^n  k^2 + (n + 1)^2 \\
			1 + S_n + 2\sum_{j = 1}^n j + n& = S_n + (n + 1)^2 \\
			\sum_{j = 1}^n j &= \dfrac{n(n + 1)}{2}
		\end{aligned}
	\]
	However, we obtain the Euler\(^{\prime}\)s trick here instead. Thus, we may apply the perturbation method to another sum.
	\[
		C_n = \sum_{k = 1}^n k^3 \Rightarrow 1 + \sum_{k = 2}^{n + 1} k^3 = C_{n + 1} = \sum_{k = 1}^n  k^3 + (n + 1)^3
	\]
	\[
		\begin{aligned}
			\sum_{k = 2}^{n + 1} k^3 &= \sum_{j = 1}^n (j + 1)^3 \quad\text{(By applying \(j = k - 1\))} \\
			&= \sum_{j = 1}^n j^3 + 3\sum_{j = 1}^n j^2 + 3\sum_{j = 1}^n j + \sum_{j = 1}^n 1 \\
			&= C_n + 3S_n + \dfrac{3n(n + 1)}{2} + n
		\end{aligned}
	\]
	By substitution, we get
	\[
	\begin{aligned}
		1 + C_n + 3S_n + \dfrac{3n(n + 1)}{2} + n &= C_n + (n + 1)^3 \\
		2 + 6S_n + 3n(n + 1) + 2n &= 2(n + 1)^3 \\
		S_n &= \dfrac{2(n + 1)^3 - 2n - 2 - 3n(n + 1)}{6} \\
		S_n &= \dfrac{(n + 1)(2(n + 1)^{2} - 2 - 3n )}{6} \\
		S_n &= \dfrac{n(n + 1)(2n + 1)}{6}
	\end{aligned}
	\]
\end{eg}

\newpage
There are some shortcut expression that might be used without finding the closed form formula on your own.
\begin{proposition}[Close form formula]
	(You can try the perturbation method to find the close form formula by yourself.)
	
	\begin{itemize}
		\item Geometric series
		\[
		\sum_{k = 0}^n ar^k = \dfrac{a(r^{n+1} - 1)}{r - 1}, r \neq 1
		\]
		\item  Euler\(^{\prime}\)s trick
		\[
		\sum_{k = 1}^n k = \dfrac{n(n+1)}{2}
		\]
		\item Quadratic series
		\[
			\sum_{k = 1}^n k^2 = \dfrac{n(n + 1)(2n + 1)}{6}
		\]
		\item Cubic series
		\[
			\sum_{k = 1}^n k^3 = \dfrac{n^2(n + 1)^2}{4}
		\]
	\end{itemize}
\end{proposition}

\section{Guess-and-Verify method}
As the name suggests, we can often guess the closed-form formula. But how can we be certain it's correct? This is where mathematical induction comes in handy.
\begin{eg}
	\[
		S_n = \sum_{k = 1}^n k^2
	\]
	Observe that \(S_n\) behaves like the sum of terms in a polynomial, allowing us to form an \(n\)-term polynomial. Since \(n^2\) is the largest term in \(S_n\), we conclude that \(S_n \leq  n^3\) 
	\[
		S_n = a + bn + cn^2 + dn^3
	\]
	\begin{alignat*}{2}
		1 &= S_1 &&= a + b + c + d,\\
		5 &= S_2 &&= a + 2b + 4c + 8d,\\
		14 &= S_3 &&= a + 3b + 9c + 27d,\\
		30 &= S_4 &&= a + 4b + 16c + 64d
	\end{alignat*}
	Solving for above, we have \(a = 0,\ b = \dfrac{1}{6},\ c = \dfrac{1}{2},\ d = \dfrac{1}{3}\).
	\[
		S_n = \dfrac{1}{6}n + \dfrac{1}{2}n^2 + \dfrac{1}{3}n^3
	\]
	After hypothesizing the closed-form formula, we need to use induction to verify its correctness. The steps are straightforward, and you can try proving it yourself. This process confirms that the formula is indeed the closed form for the summation.
\end{eg}

\newpage
\section{Multiple Summation}
All the summations above use only a single index. For example, 
\[
	S_n = \sum_{k = 1}^n k^2 = 1^2 + 2^2 + \cdots + n^2.
\]

In this section, however, we introduce a summation with multiple indices. You can think of a single-index summation as summing over a 1D array. Extending this idea, a summation with two indices corresponds to summing over a 2D array. For example,
\[
	A = \begin{bmatrix}
		a_{11} & a_{12} & \cdots & a_{1n}  \\
		a_{21} & a_{22} & \cdots & a_{2n}  \\
		\vdots & \vdots & \ddots & \vdots  \\
		a_{m1} & a_{m2} & \cdots & a_{mn}  \\
	\end{bmatrix}
\]
To sum up all the terms, we can use
\[
	r_j = a_{j1} + a_{j2} + \cdots + a_{jn} = \sum_{k = 1}^n a_{jk} 
\]
Then, we can rewrite it as
\[
	S = \sum_{j = 1}^m r_j = \sum_{j = 1}^m\sum_{k = 1}^n a_{jk}
\]

We can also interchange the order of summation, which can be very useful for finding the closed-form formula. For the above summation, it is rather simple, we can simply do the interchange by
\[
	\sum_{j = 1}^m\sum_{k = 1}^n a_{jk} = \sum_{k = 1}^n\sum_{j = 1}^m a_{jk}
\]

However, this does not work for all the summation.
\begin{eg}
	Considering
	\[
		S = \sum_{j = 1}^n \sum_{k = j}^n a_{jk}
	\]
	To visualize that, we can again use matrix
	\[
		\begin{bmatrix}
		a_{11} & a_{12} & \cdots & a_{1n}  \\
			& a_{22} & \cdots & a_{2n}  \\
			&	& \ddots & \vdots  \\
			& 	&	& a_{nn}  \\
		\end{bmatrix}
	\]
	Then, we have
	\begin{alignat*}{6}
		S &= a_{11} &+ a_{12} &+ a_{13} &+ \cdots &+ a_{1n} \\
		&	&+ a_{22} &+ a_{23} &+ \cdots &+ a_{2n} \\
		&	&	&	&\ddots &\\
		&	&	&	&	&+ a_{nn}
	\end{alignat*}
	Let \[
	c_k = a_{1k}  + a_{2k} + \cdots + a_{nk} = \sum_{j = 1}^n a_{jk}, \]

	we get
	\[
		S = \sum_{k = 1}^n c_k = \sum_{k = 1}^n \sum_{j = 1}^k a_{jk}
	\]
	\begin{remark}
		Informally, form
		\[
			S = \sum_{j = 1}^n \sum_{k = j}^n a_{jk}
		\]
		we have \(1 \leq j \leq k \leq n\), then we can simply interchange the order by
		\[
			S = \sum_{k = 1}^n \sum_{j = 1}^{k} a_{jk}
		\]
	\end{remark}
\end{eg}

Let's see another example, \(n\)-th harmonic number (\(H_n\)).

\begin{eg}
	\[
		H_n = \sum_{k = 1}^n \dfrac{1}{k}
	\]
	Again we can visualize it by using matrix
	\[
		\begin{bmatrix}
			1 &  &  &  &   \\
			1 & 1/2 &  &  &   \\
			1 & 1/2 & 1/3 &  &   \\
			  &  &  & \ddots &   \\
			1 & 1/2 & 1/3 & \cdots &1/n
		\end{bmatrix}
	\]
	\[
		S = \sum_{j = 1}^n H_j = \sum_{j = 1}^n  \sum_{k = 1}^j \dfrac{1}{k} 
	\]
	Since \(1 \leq k \leq j \leq n\) 
	\[
		S = \sum_{j = 1}^n H_j = \sum_{j = 1}^n  \sum_{k = 1}^j \dfrac{1}{k} = \sum_{k = 1}^n  \sum_{j = k}^n \dfrac{1}{k}
	\]
	Then we get
	\[
		\begin{aligned}
			S &= \sum_{k = 1}^n  \sum_{j = k}^n \dfrac{1}{k} \\
			&= \sum_{k = 1}^n \dfrac{n - k + 1}{k} \\
			&= \sum_{k = 1}^n \dfrac{n}{k} - \sum_{k = 1}^n 1 + \sum_{k = 1}^n \dfrac{1}{k} \\
			&= (n+1)H_n - n
		\end{aligned}
	\]
\end{eg}

\begin{exercise}
	For any real number \(x\), \(\lfloor x \rfloor \leq  x \leq  \lfloor x \rfloor + 1\).

	Find the closed form formula for 
	\[
		S_n = \sum_{k = 1}^n \lfloor\sqrt{k}\rfloor
	\]
	where, for simplicity, we assume that \(n\) is a perfect square, i.e., \(n = a^2\) for some integer \(a \geq 1\). 
	\begin{remark}
		Consider \(\lfloor x \rfloor = \sum_{k = 1}^x 1\), then how to do the order interchange such that we can get the following summation 
		\[
			S_n = \sum_{j = 1}^a \sum_{k = j^2}^{a^2} 1
		\]
	\end{remark}
\end{exercise}

Let's look at the last example.
\begin{eg}
	Let \(n \leq 1\) be an integer and \(x \neq 1\) be a real number. 
	\[
		S = \sum_{j = 1}^n \sum_{k = 1}^j kx^j
	\]
	By interchanging the summation orders yields
	\[
		S = \sum_{k = 1}^n \sum_{j = k}^n kx^j
	\]
	Notice that for any integer \(k\) satisfying \(1 \leq k \leq n\) it holds that
	\[
		\sum_{j = k}^n x^j = \sum_{j = 1}^n x^j - \sum_{j = 1}^{k - 1} x^j = \dfrac{x - x^{n + 1}}{1 - x} - \dfrac{x - x^k}{1 - x} = \dfrac{x^k - x^{n + 1}}{1 - x}
	\]
	Equivalently,
	\[
		\sum_{j = k}^n x^j = \dfrac{x^k - x^{n + 1}}{1 - x} = x^{k - 1} \cdot \dfrac{x - x^{n - k + 2}}{1 - x} = x^{k - 1} \cdot \sum_{j = 1}^{n - k + 1} x^j
	\]
	Then we have
	\[
		\begin{aligned}
			S &= \sum_{k = 1}^n \sum_{j = k}^n kx^j \\
			&= \sum_{k = 1}^n k \sum_{j = k}^n x^j \\
			&= \sum_{k = 1}^n k \cdot \dfrac{x^k - x^{n + 1}}{1 - x} \\
			&= \dfrac{1}{1 - x} \cdot \sum_{k = 1}^n kx^k - \dfrac{x^{n + 1}}{1 - x} \cdot \sum_{k = 1}^n k \\
			&= \dfrac{1}{1 - x} \cdot \dfrac{x\cdot(nx^{n + 1} - (n + 1)x^n + 1)}{(x - 1)^2} - \dfrac{x^{n + 1}}{1 - x} \cdot \dfrac{n(n + 1)}{2}
		\end{aligned}
	\]
\end{eg}

% END OF DOCUMENT